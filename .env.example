# ===========================================
# PIS 环境变量配置示例
# 
# 📖 快速开始（新手必读）
# ===========================================
# 
# 方式一：使用部署脚本（推荐，最简单）
#   bash docker/deploy.sh
#   脚本会自动生成所有配置，你只需要回答几个问题即可
#
# 方式二：手动配置
#   1. 复制此文件: cp .env.example .env
#   2. 编辑 .env 文件，填入实际配置值
#   3. 不要将 .env 文件提交到 Git（已在 .gitignore 中）
#
# ⚠️  重要说明：
#   - 占位符（如 AUTO_GENERATE_32）会被部署脚本自动替换为随机密钥
#   - 如果使用部署脚本，大部分配置会自动生成，你只需要填写域名等基本信息
#   - 如果手动配置，请仔细阅读每个配置项的说明
#
# 🎯 最小配置（本地测试）
#   如果你只是想本地测试，只需要修改以下配置：
#   - DOMAIN=localhost（保持不变）
#   - NEXT_PUBLIC_APP_URL=http://localhost:8088（保持不变）
#   - NEXT_PUBLIC_MEDIA_URL=http://localhost:8088/media（保持不变）
#   - NEXT_PUBLIC_WORKER_URL=http://localhost:8088/worker-api（保持不变）
#   其他配置保持默认值即可，部署脚本会自动生成密钥
#
# ===========================================

# ==================== 数据库配置 ====================
# 💡 提示：如果使用部署脚本，这些配置会自动生成，你不需要手动填写
#
# 数据库类型：postgresql（自托管，推荐）或 supabase（云服务，向后兼容）
DATABASE_TYPE=postgresql

# PostgreSQL 连接配置（方式1：使用连接字符串）
# 如果你有完整的数据库连接字符串，可以取消注释并填写：
# DATABASE_URL=postgresql://user:password@host:5432/database?sslmode=require

# PostgreSQL 连接配置（方式2：分别配置，推荐）
# ⚠️  注意：Docker 部署时，部署脚本会自动将 localhost 替换为容器名（postgres）
# 本地开发：保持 localhost
# Docker 部署：部署脚本会自动改为 postgres（容器名）
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=pis
DATABASE_USER=pis
# 💡 密码会自动生成：AUTO_GENERATE_32 会被部署脚本替换为随机密码
DATABASE_PASSWORD=AUTO_GENERATE_32
DATABASE_SSL=false

# PostgreSQL 容器密码（Docker 部署时使用，会自动与 DATABASE_PASSWORD 同步）
# 💡 这些配置会自动同步，通常不需要手动修改
POSTGRES_DB=pis
POSTGRES_USER=pis
POSTGRES_PASSWORD=AUTO_GENERATE_32

# ==================== 认证配置 ====================
# JWT 签名密钥（用于会话管理，必须与 Worker 服务器一致）
# 至少 32 字符，建议使用 64 字符十六进制字符串
AUTH_JWT_SECRET=AUTO_GENERATE_32

# 相册会话密钥（用于加密相册访问 token）
# 部署脚本会自动生成，或手动设置 64 字符十六进制字符串
ALBUM_SESSION_SECRET=AUTO_GENERATE_32

# ==================== MinIO 存储配置 ====================
# 存储类型：minio（自托管）、oss（阿里云）、cos（腾讯云）、s3（AWS）
STORAGE_TYPE=minio

# MinIO 配置（STORAGE_TYPE=minio 时使用）
# 注意：Docker 容器内应使用容器名（如 pis-minio），而不是 localhost
# 部署脚本会自动替换为正确的容器名
# 本地开发：localhost
# Docker 部署：pis-minio（容器名）
STORAGE_ENDPOINT=localhost
STORAGE_PORT=9000
STORAGE_USE_SSL=false
STORAGE_ACCESS_KEY=minioadmin
STORAGE_SECRET_KEY=minioadmin
STORAGE_BUCKET=pis-photos
# 单端口模式下，公网访问通过 Nginx 代理（如 http://localhost:8088/media）
STORAGE_PUBLIC_URL=http://localhost:8088/media

# 兼容旧配置（MinIO）
# 注意：Docker 容器内应使用容器名（如 pis-minio），而不是 localhost
# 部署脚本会自动替换为正确的容器名
# 本地开发：localhost
# Docker 部署：pis-minio（容器名）
MINIO_ENDPOINT_HOST=localhost
MINIO_ENDPOINT_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=pis-photos
# 单端口模式下，公网访问通过 Nginx 代理（如 http://localhost:8088/media）
MINIO_PUBLIC_URL=http://localhost:8088/media

# MinIO Root 用户配置（Docker Compose 使用）
# 注意：这些变量通常从 MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 映射而来
# 如果未设置，docker-compose.yml 会使用 MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 的值
# 部署脚本会自动生成或同步这些值
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# ==================== Worker 服务配置 ====================
# Worker API URL（服务端使用）
# 注意：Docker 容器内应使用容器名（如 http://pis-worker:3001），而不是 localhost
# 部署脚本会自动替换为正确的容器名
# 本地开发：http://localhost:3001
# Docker 部署：http://pis-worker:3001（容器内部地址）
WORKER_URL=http://localhost:3001
WORKER_API_URL=http://localhost:3001

# Worker API 公网 URL（前端使用，生产环境使用 HTTPS）
# 单端口模式下，前端通过 Nginx 代理访问（路径为 /worker-api）
# 本地开发：http://localhost:8088/worker-api
# 生产环境：https://域名/worker-api（如 https://pis.example.com/worker-api）
# 示例：
#   - 本地开发：http://localhost:8088/worker-api
#   - 生产环境：https://pis.example.com/worker-api
#   - 内网穿透：https://yourname.ddnsto.com/worker-api
NEXT_PUBLIC_WORKER_URL=http://localhost:8088/worker-api

# Worker API 认证密钥（必须与 Worker 服务器配置一致）
WORKER_API_KEY=AUTO_GENERATE_32

# ==================== Redis 配置 ====================
# 注意：Docker 容器内应使用容器名（如 redis），而不是 localhost
# 部署脚本会自动替换为正确的容器名
# 本地开发：localhost
# Docker 部署：pis-redis（容器名，注意：docker-compose.yml 中服务名为 redis，但容器名可能是 pis-redis）
REDIS_HOST=localhost
REDIS_PORT=6379
# Redis 密码（可选，留空表示无密码）
# 示例：your-redis-password-123
REDIS_PASSWORD=

# ==================== 应用配置 ====================
# 域名（用于生成链接、邮件等）
# 本地测试：localhost
# 生产环境：填写实际域名（如 pis.example.com）
# 如果使用 frpc/ddnsto 内网穿透，填写内网穿透提供的域名
# 示例：
#   - 本地开发：localhost
#   - 生产环境：pis.example.com
#   - frpc 穿透：pis.example.com
#   - ddnsto 穿透：yourname.ddnsto.com
DOMAIN=localhost

# 应用公网访问地址（用于生成链接、邮件等）
# 单端口模式下，所有访问通过 Nginx 的 8088 端口
# 本地开发：使用 http://localhost:8088
# 生产环境：使用 https://域名（如 https://pis.example.com）
# 内网穿透：根据穿透配置使用 https://域名 或 http://域名:端口
# 示例：
#   - 本地开发：http://localhost:8088
#   - 生产环境：https://pis.example.com
#   - frpc HTTPS：https://pis.example.com
#   - ddnsto：https://yourname.ddnsto.com
NEXT_PUBLIC_APP_URL=http://localhost:8088

# 媒体服务器公网 URL（前端访问媒体文件的地址，生产环境使用 HTTPS）
# 单端口模式下，通过 Nginx 代理访问（路径为 /media）
# 本地开发：使用相对路径 /media 或 http://localhost:8088/media
# 生产环境：使用 https://域名/media（如 https://pis.example.com/media）
# 内网穿透：使用相同的域名和 /media 路径
# 示例：
#   - 本地开发：/media 或 http://localhost:8088/media
#   - 生产环境：https://pis.example.com/media
#   - frpc HTTPS：https://pis.example.com/media
#   - ddnsto：https://yourname.ddnsto.com/media
NEXT_PUBLIC_MEDIA_URL=http://localhost:8088/media


# ==================== Cloudflare Turnstile (可选) ====================
# 用于登录页面的机器人验证（防止暴力破解）
# 如果未配置，登录页面将不显示验证码
# 获取方式：https://dash.cloudflare.com/ → 选择站点 → Turnstile → 创建站点密钥
# 示例站点密钥：0x4AAAAAAA5vowVVc5g_-Gxl
# 示例密钥：0x4AAAAAAA5vowGPXhxUGUkqVTMvC-YaLNk
NEXT_PUBLIC_TURNSTILE_SITE_KEY=
TURNSTILE_SECRET_KEY=

# ==================== Cloudflare CDN 缓存清除 (可选) ====================
# 用于在删除照片时自动清除 CDN 缓存
# 如果未配置，删除照片后 CDN 缓存可能仍存在一段时间
# 获取方式：https://dash.cloudflare.com/ → My Profile → API Tokens → 创建令牌
# 示例 API Token：eefd8ypDgq_kJO2OivNQy7VFU6qj12KM7c1u03k3
# Zone ID 在域名概览页面右侧可以看到
# 示例 Zone ID：55be2d2f25313170ff6a622cda4c37ec
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ZONE_ID=

# ==================== 向后兼容配置（Supabase，可选）====================
# 如果 DATABASE_TYPE=supabase，需要配置以下变量
# 获取方式：Supabase Dashboard → Project Settings → API
# 示例：
# SUPABASE_URL=https://abcdefghijklmnop.supabase.co
# SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
# NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
# NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_URL=
SUPABASE_SERVICE_ROLE_KEY=
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=

# ==================== 轮询配置（可选）====================
# 用于替代 Supabase Realtime 的轮询间隔（毫秒）
# 默认值：3000（3秒）
NEXT_PUBLIC_POLLING_INTERVAL=3000
NEXT_PUBLIC_ADMIN_POLLING_INTERVAL=2000

# ==================== 日志配置（可选）====================
# 日志级别：trace, debug, info, warn, error, fatal
# 默认值：info
LOG_LEVEL=info

# 日志目录（Worker 服务使用，默认：logs）
LOG_DIR=logs

# 是否启用文件日志（Worker 服务，默认：true）
ENABLE_FILE_LOG=true

# 是否启用彩色日志输出（开发环境默认启用）
ENABLE_PRETTY_LOG=false

# ==================== 升级功能配置（可选）====================
# 项目根目录路径（用于升级检查功能）
# Docker 部署时，如果挂载了项目目录到容器，设置此变量指向挂载路径
# 服务器部署路径通常是 /opt/pis
# 示例：
#   - 服务器部署：/opt/pis
#   - 自定义路径：/app/pis
# 如果不设置，系统会尝试自动检测（可能不准确）
PROJECT_ROOT=

# Docker Compose 挂载路径配置（可选）
# 容器内项目根目录的挂载路径（默认 /opt/pis）
# 如果需要在容器内使用不同的路径，可以设置此变量
# 例如：PROJECT_ROOT_MOUNT_PATH=/app/pis
# 注意：此变量需要在 docker-compose.yml 中使用，通常不需要修改
# PROJECT_ROOT_MOUNT_PATH=/opt/pis

# ==================== FTP 配置（相机直传，可选）====================
# 💡 提示：只有需要使用相机 FTP 直传功能时才需要配置
#
# FTP 被动模式返回的公网地址
# 💡 填写说明：
#   - 局域网部署：填写服务器局域网 IP，如 192.168.50.10
#   - 公网部署：填写公网 IP 或域名，如 ftp.example.com
#   - 使用 frp 内网穿透：填写 frps 服务器的公网 IP 或域名
#   - 不需要 FTP 功能：留空即可（系统会自动检测，可能不准确）
# 示例：
#   - 局域网：192.168.50.10
#   - 公网 IP：123.45.67.89
#   - 公网域名：ftp.yourdomain.com
FTP_PASV_URL=

# FTP 被动模式端口范围（默认 30000-30009）
# 注意：如果使用 frp 穿透，需要在 frps 服务器防火墙开放这些端口
# FTP_PASV_MIN=30000
# FTP_PASV_MAX=30009


# ==================== 告警配置（可选）====================
# 用于系统告警通知（如错误、警告等）
# 如果未配置，告警将仅记录到日志

# 是否启用告警（默认：true）
ALERT_ENABLED=true

# 告警类型：telegram（Telegram 机器人）、email（邮件）、log（仅日志）
ALERT_TYPE=log

# Telegram 告警配置（ALERT_TYPE=telegram 时使用）
# 获取方式：
# 1. 在 Telegram 搜索 @BotFather，创建机器人获取 Bot Token
# 2. 在 Telegram 搜索 @userinfobot，获取你的 Chat ID
# 示例 Bot Token：123456789:ABCdefGHIjklMNOpqrsTUVwxyz
# 示例 Chat ID：123456789
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# 邮件告警配置（ALERT_TYPE=email 时使用）
# 注意：这些变量与上面的 SMTP_* 变量不同，用于告警通知
# 示例：
# ALERT_SMTP_HOST=smtp.gmail.com
# ALERT_SMTP_PORT=587
# ALERT_SMTP_USER=alerts@yourdomain.com
# ALERT_SMTP_PASS=your-app-password
# ALERT_FROM_EMAIL=alerts@yourdomain.com
# ALERT_TO_EMAIL=admin@yourdomain.com
ALERT_SMTP_HOST=
ALERT_SMTP_PORT=587
ALERT_SMTP_USER=
ALERT_SMTP_PASS=
ALERT_FROM_EMAIL=
ALERT_TO_EMAIL=

# ==================== 认证配置（可选）====================
# 认证模式：custom（自定义认证，推荐）或 supabase（Supabase Auth）
# 默认：custom
AUTH_MODE=custom
