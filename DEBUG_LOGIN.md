# ğŸ” ç™»å½•è°ƒè¯•æ—¥å¿—æŸ¥çœ‹æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€

- âœ… æ•°æ®åº“å·²é‡ç½®
- âœ… ç®¡ç†å‘˜è´¦æˆ·å·²åˆ›å»ºï¼š`admin@pis.com`
- âœ… å¯†ç å“ˆå¸Œæ ¼å¼æ­£ç¡®ï¼ˆé•¿åº¦ 200ï¼Œæ ¼å¼ï¼š`salt:iterations:hash`ï¼‰
- âŒ ç™»å½•å¤±è´¥ï¼ˆ401 é”™è¯¯ï¼šé‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼‰

## ğŸ” å¦‚ä½•æŸ¥çœ‹è°ƒè¯•æ—¥å¿—

### 1. æŸ¥çœ‹ Next.js å¼€å‘æœåŠ¡å™¨æ—¥å¿—

**æ—¥å¿—ä½ç½®**ï¼šè¿è¡Œ `pnpm dev` çš„ç»ˆç«¯çª—å£

**å…³é”®æ—¥å¿—æ ‡è®°**ï¼š
- `[Login]` - ç™»å½•æµç¨‹æ—¥å¿—
- `[VerifyPassword]` - å¯†ç éªŒè¯æ—¥å¿—
- `[SetupPassword]` - å¯†ç è®¾ç½®æ—¥å¿—
- `[UpdateUserPassword]` - å¯†ç æ›´æ–°æ—¥å¿—

### 2. é¢„æœŸçš„è°ƒè¯•æ—¥å¿—è¾“å‡º

å½“ä½ å°è¯•ç™»å½•æ—¶ï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ—¥å¿—ï¼š

```
[Login] Verifying password: {
  email: 'admin@pis.com',
  passwordHashExists: true,
  passwordHashLength: 200,
  passwordHashFormat: 'valid',
  passwordHashPreview: '3912e7e8c4ef0aead057...'
}

[VerifyPassword] Verification result: {
  isValid: false,
  saltLength: 64,
  iterations: 100000,
  storedHashLength: 128,
  derivedHashLength: 128,
  hashMatch: false
}

[Login] Password verification result: {
  email: 'admin@pis.com',
  isValid: false
}
```

### 3. æ£€æŸ¥è¦ç‚¹

1. **å¯†ç å“ˆå¸Œæ ¼å¼**ï¼šç¡®è®¤ `passwordHashFormat` ä¸º `'valid'`
2. **å¯†ç éªŒè¯ç»“æœ**ï¼šæŸ¥çœ‹ `isValid` çš„å€¼
3. **å“ˆå¸ŒåŒ¹é…**ï¼šæŸ¥çœ‹ `hashMatch` çš„å€¼
4. **é”™è¯¯ä¿¡æ¯**ï¼šæŸ¥çœ‹æ˜¯å¦æœ‰ `[VerifyPassword] Verification error` æˆ– `Login error`

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šå¯†ç ä¸åŒ¹é…

**ç—‡çŠ¶**ï¼š`isValid: false`, `hashMatch: false`

**å¯èƒ½åŸå› **ï¼š
- è¾“å…¥çš„å¯†ç ä¸è®¾ç½®æ—¶ä¸åŒ
- å¯†ç åœ¨è®¾ç½®æ—¶å“ˆå¸Œè®¡ç®—æœ‰è¯¯
- æ•°æ®åº“ä¸­çš„å“ˆå¸Œå€¼æŸå

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤è¾“å…¥çš„å¯†ç æ˜¯å¦æ­£ç¡®
2. é‡æ–°è®¾ç½®å¯†ç 
3. æ£€æŸ¥å¯†ç è®¾ç½®æ—¶çš„æ—¥å¿—

### é—®é¢˜ 2ï¼šå“ˆå¸Œæ ¼å¼é”™è¯¯

**ç—‡çŠ¶**ï¼š`passwordHashFormat: 'invalid'` æˆ– `[VerifyPassword] Invalid hash format`

**å¯èƒ½åŸå› **ï¼š
- æ•°æ®åº“ä¸­çš„å“ˆå¸Œå€¼æ ¼å¼ä¸æ­£ç¡®
- å“ˆå¸Œå€¼è¢«æˆªæ–­æˆ–æŸå

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é‡ç½®æ•°æ®åº“
2. é‡æ–°è®¾ç½®å¯†ç 

### é—®é¢˜ 3ï¼šæ²¡æœ‰çœ‹åˆ°è°ƒè¯•æ—¥å¿—

**å¯èƒ½åŸå› **ï¼š
- `NODE_ENV` ä¸æ˜¯ `'development'`
- æ—¥å¿—è¢«å…¶ä»–è¾“å‡ºæ·¹æ²¡

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `.env.local` ä¸­æ²¡æœ‰è®¾ç½® `NODE_ENV=production`
2. åœ¨ç»ˆç«¯ä¸­æœç´¢ `[Login]` æˆ– `[VerifyPassword]`

## ğŸ“ æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€è¿è¡Œ `pnpm dev` çš„ç»ˆç«¯çª—å£**
2. **å°è¯•ç™»å½•**ï¼ˆä½¿ç”¨æµè§ˆå™¨æˆ–æµ‹è¯•è„šæœ¬ï¼‰
3. **æŸ¥çœ‹ç»ˆç«¯è¾“å‡º**ï¼ŒæŸ¥æ‰¾åŒ…å« `[Login]` çš„æ—¥å¿—è¡Œ
4. **å¤åˆ¶ç›¸å…³æ—¥å¿—**ï¼Œç”¨äºè¿›ä¸€æ­¥åˆ†æ

## ğŸ”§ å¿«é€Ÿæµ‹è¯•è„šæœ¬

å·²åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼š`test-login-debug.sh`

è¿è¡Œæ–¹å¼ï¼š
```bash
bash test-login-debug.sh
```

## ğŸ’¡ ä¸‹ä¸€æ­¥

1. æŸ¥çœ‹è¿è¡Œ `pnpm dev` çš„ç»ˆç«¯çª—å£
2. å°è¯•ç™»å½•
3. å¤åˆ¶åŒ…å« `[Login]` æˆ– `[VerifyPassword]` çš„æ—¥å¿—
4. å°†æ—¥å¿—å‘é€ç»™æˆ‘è¿›è¡Œè¿›ä¸€æ­¥åˆ†æ
